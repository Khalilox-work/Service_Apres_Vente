{% extends 'base.html' %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">
                <i class="bi bi-speedometer2 me-2"></i>Tableau de Bord Administrateur
            </h1>
            <p class="text-muted small mb-0">
                <i class="bi bi-calendar3 me-1"></i>{{ current_date|date:"l d F Y" }}
            </p>
        </div>
        <div class="d-flex gap-2">
            <div class="btn-group shadow-sm">
                <button type="button" class="btn btn-primary" data-bs-toggle="dropdown">
                    <i class="bi bi-plus-circle me-1"></i>Nouveau
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <a class="dropdown-item" href="{% url 'admin:Appli_SAV_client_add' %}">
                            <i class="bi bi-person-plus me-2"></i>Client
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="{% url 'admin:Appli_SAV_technicien_add' %}">
                            <i class="bi bi-wrench me-2"></i>Technicien
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="{% url 'admin:Appli_SAV_machine_add' %}">
                            <i class="bi bi-pc-display me-2"></i>Machine
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item" href="{% url 'admin:Appli_SAV_demandereparation_add' %}">
                            <i class="bi bi-tools me-2"></i>Demande de Réparation
                        </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item" href="{% url 'admin:Appli_SAV_customuser_add' %}">
                            <i class="bi bi-person-plus-fill me-2"></i>Utilisateur
                        </a>
                    </li>
                </ul>
            </div>
            <a href="/admin/" target="_blank" class="btn btn-outline-primary shadow-sm">
                <i class="bi bi-gear me-1"></i>Interface Admin Django
            </a>
        </div>
    </div>

    <!-- Statistics Cards Row -->
    <div class="row g-4 mb-4">
        <!-- Clients Card -->
        <div class="col-md-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100 bg-gradient">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-primary mb-0">Total Clients</h6>
                            <h2 class="mt-2 mb-0 display-6">{{ stats.clients }}</h2>
                            <p class="text-muted small mb-0">
                                <i class="bi bi-arrow-up me-1"></i>
                                {{ stats.new_clients_week }} nouveaux cette semaine
                            </p>
                        </div>
                        <div class="icon-shape bg-primary bg-opacity-10 text-primary rounded-3 p-3">
                            <i class="bi bi-people fs-1"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <a href="{% url 'admin:Appli_SAV_client_changelist' %}" class="text-primary text-decoration-none small">
                        <i class="bi bi-arrow-right me-1"></i>Voir tous les clients
                    </a>
                </div>
            </div>
        </div>

        <!-- Technicians Card -->
        <div class="col-md-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100 bg-gradient">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-success mb-0">Total Techniciens</h6>
                            <h2 class="mt-2 mb-0 display-6">{{ stats.techniciens }}</h2>
                            <p class="text-muted small mb-0">
                                <i class="bi bi-tools me-1"></i>
                                Équipe technique
                            </p>
                        </div>
                        <div class="icon-shape bg-success bg-opacity-10 text-success rounded-3 p-3">
                            <i class="bi bi-wrench fs-1"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <a href="{% url 'admin:Appli_SAV_technicien_changelist' %}" class="text-success text-decoration-none small">
                        <i class="bi bi-arrow-right me-1"></i>Voir tous les techniciens
                    </a>
                </div>
            </div>
        </div>

        <!-- Machines Card -->
        <div class="col-md-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100 bg-gradient">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-info mb-0">Total Machines</h6>
                            <h2 class="mt-2 mb-0 display-6">{{ stats.machines }}</h2>
                            <p class="text-muted small mb-0">
                                <i class="bi bi-pc-display me-1"></i>
                                Parc informatique
                            </p>
                        </div>
                        <div class="icon-shape bg-info bg-opacity-10 text-info rounded-3 p-3">
                            <i class="bi bi-pc-display fs-1"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <a href="{% url 'admin:Appli_SAV_machine_changelist' %}" class="text-info text-decoration-none small">
                        <i class="bi bi-arrow-right me-1"></i>Voir toutes les machines
                    </a>
                </div>
            </div>
        </div>

        <!-- Repair Requests Card -->
        <div class="col-md-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100 bg-gradient">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-warning mb-0">Demandes en Attente</h6>
                            <h2 class="mt-2 mb-0 display-6">{{ stats.demandes_en_attente }}</h2>
                            <p class="text-muted small mb-0">
                                <i class="bi bi-clock-history me-1"></i>
                                {{ stats.new_demandes_week }} nouvelles cette semaine
                            </p>
                        </div>
                        <div class="icon-shape bg-warning bg-opacity-10 text-warning rounded-3 p-3">
                            <i class="bi bi-clock-history fs-1"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <a href="{% url 'admin:Appli_SAV_demandereparation_changelist' %}" class="text-warning text-decoration-none small">
                        <i class="bi bi-arrow-right me-1"></i>Voir toutes les demandes
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Row -->
    <div class="row g-4">
        <!-- Quick Actions -->
        <div class="col-12 col-xl-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-lightning me-2"></i>Actions Rapides
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <a href="{% url 'admin:Appli_SAV_client_add' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <div class="icon-shape bg-primary bg-opacity-10 text-primary rounded-3 me-3 p-2">
                                <i class="bi bi-person-plus"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">Ajouter un Client</h6>
                                <small class="text-muted">Créer un nouveau compte client</small>
                            </div>
                        </a>
                        <a href="{% url 'admin:Appli_SAV_technicien_add' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <div class="icon-shape bg-success bg-opacity-10 text-success rounded-3 me-3 p-2">
                                <i class="bi bi-person-plus-fill"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">Ajouter un Technicien</h6>
                                <small class="text-muted">Créer un nouveau compte technicien</small>
                            </div>
                        </a>
                        <a href="{% url 'admin:Appli_SAV_machine_add' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <div class="icon-shape bg-info bg-opacity-10 text-info rounded-3 me-3 p-2">
                                <i class="bi bi-pc-display"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">Ajouter une Machine</h6>
                                <small class="text-muted">Enregistrer un nouvel équipement</small>
                            </div>
                        </a>
                        <a href="{% url 'admin:Appli_SAV_demandereparation_changelist' %}?date_validation__isnull=True" 
                           class="list-group-item list-group-item-action d-flex align-items-center">
                            <div class="icon-shape bg-warning bg-opacity-10 text-warning rounded-3 me-3 p-2">
                                <i class="bi bi-clock"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">Demandes en Attente</h6>
                                <small class="text-muted">Voir les demandes non traitées</small>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="col-12 col-xl-8">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-graph-up me-2"></i>État du Système
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-4">
                        <!-- Repair Request Status -->
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h6 class="card-title">Demandes de Réparation</h6>
                                    <div class="progress mb-3" style="height: 20px;">
                                        <div class="progress-bar bg-success" role="progressbar" 
                                             style="width: {{ stats.completed_percent }}%">
                                            {{ stats.completed_percent|floatformat:1 }}%
                                        </div>
                                        <div class="progress-bar bg-warning" role="progressbar" 
                                             style="width: {{ stats.pending_percent }}%">
                                            {{ stats.pending_percent|floatformat:1 }}%
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge bg-success">
                                            <i class="bi bi-check-circle me-1"></i>Traitées
                                        </span>
                                        <span class="badge bg-warning">
                                            <i class="bi bi-clock me-1"></i>En attente
                                        </span>
                                    </div>
                                    <p class="text-muted small mt-2 mb-0">
                                        {{ stats.demandes_en_attente }} demandes en attente sur {{ stats.demandes_total }} au total
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Machine Types Distribution -->
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <h6 class="card-title">Types de Machines</h6>
                                    <div class="chart-container" style="position: relative; height: 250px;">
                                        <canvas id="machineTypesChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style type="text/css">
.bg-gradient {
    background: linear-gradient(180deg, rgba(255,255,255,1) 0%, rgba(249,250,251,1) 100%);
}

.icon-shape {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    border-radius: 0.75rem;
}

.display-6 {
    font-size: 2rem;
    font-weight: 600;
    line-height: 1.2;
}

.list-group-item {
    border: none;
    padding: 1rem;
    transition: all 0.2s ease-in-out;
}

.list-group-item:hover {
    background-color: #f8f9fa;
    transform: translateX(5px);
}

.card {
    transition: all 0.2s ease-in-out;
}

.card:hover {
    transform: translateY(-5px);
}

.progress {
    border-radius: 1rem;
    background-color: #e9ecef;
}

.progress-bar {
    transition: width 0.6s ease;
}

.badge {
    padding: 0.5rem 0.75rem;
    font-weight: 500;
}

.dropdown-item {
    padding: 0.5rem 1rem;
    transition: all 0.2s ease-in-out;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
    transform: translateX(5px);
}
</style>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    const machineTypesChart = new Chart(
        document.getElementById('machineTypesChart'),
        {
            type: 'doughnut',
            data: {
                labels: [
                    {% for type in machine_types %}
                        '{{ type.machine_type|title }}',
                    {% endfor %}
                ],
                datasets: [{
                    data: [
                        {% for type in machine_types %}
                            {{ type.count }},
                        {% endfor %}
                    ],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(255, 99, 132, 0.8)',
                        'rgba(75, 192, 192, 0.8)'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'circle',
                            font: {
                                size: 12
                            },
                            boxWidth: 8
                        }
                    }
                },
                layout: {
                    padding: {
                        top: 10,
                        bottom: 20
                    }
                },
                cutout: '60%'
            }
        }
    );
});
</script>
{% endblock %} 